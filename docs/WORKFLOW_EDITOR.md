# StructForge AI - 工作流编辑器说明

## 🎨 界面设计（模仿 n8n）

基于 n8n 工作流编辑器的设计理念，我们实现了类似的视觉化工作流编辑器。

### 界面组成

#### 1. 顶部栏（WorkflowHeader）
- **工作流名称**：显示当前工作流名称，可添加标签
- **状态切换**：激活/未激活开关
- **操作按钮**：分享、保存、历史版本、收藏
- **标签页**：编辑器 / 执行记录 / 评估

#### 2. 画布区域（WorkflowCanvas）
- **网格背景**：浅灰色点状网格，便于对齐
- **节点拖拽**：可自由拖拽节点位置
- **连线功能**：从节点输出端口拖拽到输入端口创建连接
- **小地图**：右下角显示整体视图
- **控制按钮**：缩放、适应画布等

#### 3. 右侧工具栏（WorkflowToolbar）
- **缩放控制**：放大、缩小、适应画布
- **添加节点**：紫色渐变按钮，打开节点库

#### 4. 底部栏
- **执行按钮**：醒目的大按钮，执行当前工作流
- **日志面板**：显示执行日志（待实现）

---

## 📦 节点类型

### 当前实现的节点

1. **解析文件（parse_file）**
   - 图标：📄 FileTextOutlined
   - 颜色：蓝色 (#1890ff)
   - 功能：读取并解析配置文件
   - 输入：无（触发节点）
   - 输出：解析后的数据和Schema

2. **分析Schema（analyze_schema）**
   - 图标：🔌 ApiOutlined
   - 颜色：绿色 (#52c41a)
   - 功能：深度分析数据结构
   - 输入：解析文件节点的输出
   - 输出：学习后的Schema和关系图谱

3. **自然语言处理（process_natural_language）**
   - 图标：💬 CommentOutlined
   - 颜色：紫色 (#722ed1)
   - 功能：理解自然语言指令
   - 输入：Schema分析节点的输出
   - 输出：操作意图

4. **应用操作（apply_operations）**
   - 图标：🔧 ToolOutlined
   - 颜色：橙色 (#fa8c16)
   - 功能：执行数据修改操作
   - 输入：自然语言处理节点的输出
   - 输出：修改后的数据

5. **导出文件（export_file）**
   - 图标：📤 ExportOutlined
   - 颜色：粉色 (#eb2f96)
   - 功能：导出处理后的数据
   - 输入：应用操作节点的输出
   - 输出：导出文件路径

---

## 🎯 核心功能

### 1. 节点操作
- ✅ **拖拽移动**：点击节点可拖拽到任意位置
- ✅ **选择节点**：点击节点选中，显示高亮边框
- ✅ **状态显示**：显示节点执行状态（pending/running/completed/failed）

### 2. 连线功能
- ✅ **创建连线**：从输出端口拖拽到输入端口
- ✅ **曲线连接**：使用平滑曲线连接节点
- ✅ **动画效果**：连线有动画效果，悬停时高亮

### 3. 画布操作
- ✅ **缩放**：使用右侧控制按钮或鼠标滚轮
- ✅ **平移**：拖拽空白区域移动画布
- ✅ **小地图**：右下角显示整体视图

### 4. 工作流操作
- ✅ **保存工作流**：保存节点和连线配置
- ✅ **执行工作流**：底部按钮执行完整流程
- ✅ **状态切换**：激活/停用工作流

---

## 🚀 使用方法

### 访问编辑器

1. **从工作流页面进入**：
   - 访问 `/workflow` 页面
   - 点击"打开编辑器"按钮

2. **直接访问**：
   - 访问 `/workflow/editor` 路由

### 创建节点连接

1. 将鼠标悬停在节点的输出端口（右侧圆点）
2. 拖拽到目标节点的输入端口（左侧圆点）
3. 释放鼠标，创建连线

### 执行工作流

1. 构建完整的节点链（从 parse_file 到 export_file）
2. 点击底部"执行工作流"按钮
3. 在弹出框中选择要执行的工作流类型
4. 点击确认执行

---

## 📁 文件结构

```
frontend/src/
├── components/
│   └── Workflow/
│       ├── WorkflowNode.tsx      # 节点组件
│       ├── WorkflowNode.css
│       ├── WorkflowCanvas.tsx    # 画布组件
│       ├── WorkflowCanvas.css
│       ├── WorkflowToolbar.tsx   # 工具栏组件
│       ├── WorkflowToolbar.css
│       ├── WorkflowHeader.tsx    # 顶部栏组件
│       └── WorkflowHeader.css
└── pages/
    ├── WorkflowEditor.tsx        # 编辑器主页面
    └── WorkflowEditor.css
```

---

## 🔧 技术实现

### 使用的库

- **React Flow Renderer**：工作流可视化核心库
- **Ant Design**：UI组件库
- **React Hooks**：状态管理

### 关键实现

1. **节点渲染**：自定义节点组件，支持不同类型和状态
2. **连线管理**：使用React Flow的Edge系统
3. **状态同步**：节点和连线状态实时同步到父组件
4. **响应式布局**：全屏显示，适配不同屏幕尺寸

---

## 🎨 设计特点

### 视觉风格

- **现代化UI**：清晰的层次和间距
- **颜色区分**：不同节点类型使用不同颜色
- **状态反馈**：节点状态可视化（颜色点）
- **交互反馈**：悬停和选中效果

### 用户体验

- **直观操作**：拖拽式操作，无需代码
- **即时反馈**：操作有视觉反馈
- **错误提示**：友好的错误提示信息

---

## 📝 待完善功能

1. ⬜ **节点配置面板**：点击节点显示配置选项
2. ⬜ **节点库面板**：右侧滑出节点库，可选择添加
3. ⬜ **删除节点/连线**：支持删除操作
4. ⬜ **复制粘贴**：节点复制粘贴功能
5. ⬜ **撤销重做**：操作历史管理
6. ⬜ **日志面板**：底部日志显示执行日志
7. ⬜ **工作流保存**：保存到后端API
8. ⬜ **导入导出**：工作流配置的导入导出

---

## 🔄 与后端集成

### 工作流执行流程

1. 前端收集节点和连线信息
2. 转换为后端工作流定义
3. 调用 `POST /api/v1/workflows/execute/{workflow_id}` API
4. 显示执行结果和状态

### 节点映射

前端节点类型映射到后端工作流步骤：

```typescript
{
  'parse_file': 'parse_file_step',
  'analyze_schema': 'analyze_schema_step',
  'process_natural_language': 'process_natural_language_step',
  'apply_operations': 'apply_operations_step',
  'export_file': 'export_file_step'
}
```

---

**最后更新**：2024年  
**版本**：v0.1.0-alpha

