# ChatGPT Agent èŠ‚ç‚¹è®¾è®¡æ–‡æ¡£

## ğŸ¯ è®¾è®¡ç›®æ ‡

åˆ›å»ºä¸€ä¸ªä¸“é—¨é’ˆå¯¹ **ChatGPT (OpenAI Responses API)** çš„ Agent èŠ‚ç‚¹ï¼Œå……åˆ†åˆ©ç”¨å…¶ç‹¬ç‰¹ç‰¹æ€§ï¼š

1. **å¤šæ¨¡æ€è¾“å…¥**ï¼šæ”¯æŒæ–‡å­—ã€å›¾ç‰‡ã€æ–‡ä»¶å†…å®¹ï¼ˆURLï¼‰
2. **æ–‡ä»¶ä¸Šä¼ **ï¼šæ”¯æŒä¸Šä¼ æ–‡ä»¶å¹¶ä½¿ç”¨ `file_id`
3. **MCP æœåŠ¡**ï¼šæ”¯æŒè¿œç¨‹è°ƒç”¨ MCP (Model Context Protocol) æœåŠ¡
4. **Agent åä½œ**ï¼šæ”¯æŒå¤š Agent åä½œï¼ˆæœªæ¥æ‰©å±•ï¼‰

## ğŸ“Š æ¶æ„è®¾è®¡

### èŠ‚ç‚¹ç±»å‹ï¼š`chatgpt_agent`

ä¸å½“å‰ `ai_agent` èŠ‚ç‚¹çš„åŒºåˆ«ï¼š
- **`ai_agent`**ï¼šé€šç”¨ Agentï¼Œéœ€è¦è¿æ¥ Chat Model èŠ‚ç‚¹ï¼Œæ”¯æŒå¤šç§æ¨¡å‹ï¼ˆChatGPT/Gemini/DeepSeekï¼‰
- **`chatgpt_agent`**ï¼šä¸“é—¨é’ˆå¯¹ ChatGPTï¼Œå†…ç½® API é…ç½®ï¼Œå……åˆ†åˆ©ç”¨ Responses API ç‰¹æ€§

### è¿æ¥ç‚¹è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ChatGPT Agent      â”‚
â”‚                     â”‚
â”‚  [Input] â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€ æ•°æ®è¾“å…¥ï¼ˆæ–‡å­—ã€å›¾ç‰‡ã€æ–‡ä»¶ï¼‰
â”‚                     â”‚
â”‚  [Output] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€ è¾“å‡ºç»“æœ
â”‚                     â”‚
â”‚  [Memory] â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€ è®°å¿†å­˜å‚¨ï¼ˆå¯é€‰ï¼‰
â”‚                     â”‚
â”‚  [Tool] â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€ å·¥å…·/æ‰©å±•ï¼ˆå¯é€‰ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¿æ¥ç‚¹è¯´æ˜**ï¼š
- **Input**ï¼ˆå·¦ä¾§ï¼‰ï¼šæ¥æ”¶ä¸Šæ¸¸èŠ‚ç‚¹çš„æ•°æ®ï¼ˆæ–‡å­—ã€å›¾ç‰‡URLã€æ–‡ä»¶URLç­‰ï¼‰
- **Output**ï¼ˆå³ä¾§ï¼‰ï¼šè¾“å‡ºå¤„ç†åçš„ç»“æœ
- **Memory**ï¼ˆåº•éƒ¨ï¼‰ï¼šè¿æ¥ Memory èŠ‚ç‚¹ï¼ˆå¯é€‰ï¼‰
- **Tool**ï¼ˆåº•éƒ¨ï¼‰ï¼šè¿æ¥ Tool èŠ‚ç‚¹æˆ– MCP æœåŠ¡ï¼ˆå¯é€‰ï¼‰

**æ³¨æ„**ï¼šä¸å†éœ€è¦å•ç‹¬çš„ Chat Model è¿æ¥ç‚¹ï¼Œå› ä¸º API é…ç½®ç›´æ¥å†…ç½®åœ¨èŠ‚ç‚¹ä¸­ã€‚

## ğŸ”§ åŠŸèƒ½ç‰¹æ€§

### 1. å¤šæ¨¡æ€è¾“å…¥æ”¯æŒ

#### è¾“å…¥æ ¼å¼
```typescript
interface ChatGPTAgentInput {
  // æ–‡å­—è¾“å…¥
  text?: string
  
  // å›¾ç‰‡è¾“å…¥ï¼ˆURLï¼‰
  images?: Array<{
    url: string
    type: 'input_image'
  }>
  
  // æ–‡ä»¶è¾“å…¥ï¼ˆURL æˆ– file_idï¼‰
  files?: Array<{
    url?: string      // è¿œç¨‹æ–‡ä»¶ URL
    file_id?: string  // å·²ä¸Šä¼ æ–‡ä»¶çš„ ID
    type: 'input_file'
  }>
  
  // ä¸Šæ¸¸èŠ‚ç‚¹æ•°æ®ï¼ˆè‡ªåŠ¨è½¬æ¢ï¼‰
  upstream_data?: any
}
```

#### è‡ªåŠ¨è½¬æ¢é€»è¾‘
- å¦‚æœè¾“å…¥æ˜¯ `ParsedFile` ç±»å‹ï¼š
  - `file_path` â†’ è½¬æ¢ä¸ºæ–‡ä»¶ URL æˆ–ä¸Šä¼ æ–‡ä»¶è·å– `file_id`
  - `data` â†’ è½¬æ¢ä¸ºæ–‡å­—è¾“å…¥
  - `analysis` â†’ è½¬æ¢ä¸ºæ–‡å­—è¾“å…¥ï¼ˆJSON æ ¼å¼ï¼‰

### 2. æ–‡ä»¶ä¸Šä¼ æ”¯æŒ

#### æ–‡ä»¶ä¸Šä¼ æµç¨‹
```python
# åç«¯å¤„ç†
1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆfile_pathï¼‰
2. å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œä¸Šä¼ åˆ° OpenAI Files API
3. è·å– file_id
4. åœ¨è¯·æ±‚ä¸­ä½¿ç”¨ file_id
```

#### é…ç½®é€‰é¡¹
- **è‡ªåŠ¨ä¸Šä¼ **ï¼šè‡ªåŠ¨ä¸Šä¼ æœ¬åœ°æ–‡ä»¶åˆ° OpenAI
- **ä½¿ç”¨ URL**ï¼šç›´æ¥ä½¿ç”¨æ–‡ä»¶ URLï¼ˆå¦‚æœæ–‡ä»¶å·²åœ¨çº¿ï¼‰
- **æ–‡ä»¶ä¿ç•™ç­–ç•¥**ï¼šæ‰§è¡Œåæ˜¯å¦åˆ é™¤ä¸Šä¼ çš„æ–‡ä»¶

### 3. MCP æœåŠ¡æ”¯æŒ

#### MCP æœåŠ¡é…ç½®
```typescript
interface MCPServiceConfig {
  server_label: string
  server_description: string
  server_url: string
  require_approval: 'never' | 'always' | 'auto'
}
```

#### ä½¿ç”¨åœºæ™¯
- è¿æ¥åˆ°å¤–éƒ¨ MCP æœåŠ¡å™¨
- æ‰©å±• ChatGPT çš„èƒ½åŠ›ï¼ˆå¦‚æ•°æ®åº“æŸ¥è¯¢ã€API è°ƒç”¨ç­‰ï¼‰

### 4. Agent åä½œï¼ˆæœªæ¥æ‰©å±•ï¼‰

æ”¯æŒå¤š Agent åä½œï¼Œæ¯ä¸ª Agent æœ‰ç‰¹å®šçš„è§’è‰²å’ŒæŒ‡ä»¤ã€‚

## ğŸ“ é…ç½®ç•Œé¢è®¾è®¡

### åŸºæœ¬é…ç½®
- **èŠ‚ç‚¹åç§°**ï¼šChatGPT Agent
- **èŠ‚ç‚¹æè¿°**ï¼šOpenAI ChatGPT Responses API Agent

### API é…ç½®
- **API Key**ï¼šOpenAI API Keyï¼ˆå¿…éœ€ï¼‰
- **API URL**ï¼šé»˜è®¤ `https://api.openai.com/v1/responses`
- **æ¨¡å‹é€‰æ‹©**ï¼š`gpt-5`, `gpt-5-nano`, `gpt-4o`, `gpt-4o-mini`

### è¾“å…¥é…ç½®
- **è¾“å…¥æ¨¡å¼**ï¼š
  - ç®€å•æ–‡å­—è¾“å…¥
  - å¤šæ¨¡æ€è¾“å…¥ï¼ˆæ–‡å­— + å›¾ç‰‡ + æ–‡ä»¶ï¼‰
  - è‡ªåŠ¨ä»ä¸Šæ¸¸èŠ‚ç‚¹è½¬æ¢

### æ–‡ä»¶å¤„ç†é…ç½®
- **æ–‡ä»¶ä¸Šä¼ ç­–ç•¥**ï¼šè‡ªåŠ¨ä¸Šä¼  / ä½¿ç”¨ URL / æ‰‹åŠ¨æŒ‡å®š
- **æ–‡ä»¶ä¿ç•™**ï¼šæ‰§è¡Œååˆ é™¤ / ä¿ç•™æ–‡ä»¶

### MCP æœåŠ¡é…ç½®ï¼ˆå¯é€‰ï¼‰
- **å¯ç”¨ MCP**ï¼šå¼€å…³
- **MCP æœåŠ¡å™¨é…ç½®**ï¼šæœåŠ¡å™¨æ ‡ç­¾ã€æè¿°ã€URLã€å®¡æ‰¹ç­–ç•¥

### é«˜çº§é…ç½®
- **ç³»ç»Ÿæç¤ºè¯**ï¼šAgent çš„è§’è‰²å’ŒæŒ‡ä»¤
- **Temperature**ï¼šæ ¹æ®æ¨¡å‹è‡ªåŠ¨è°ƒæ•´ï¼ˆæŸäº›æ¨¡å‹ä¸æ”¯æŒï¼‰
- **Instructions**ï¼šé¢å¤–çš„æŒ‡ä»¤
- **Reasoning**ï¼šæ¨ç†æ¨¡å¼ï¼ˆå¦‚æœæ¨¡å‹æ”¯æŒï¼‰

## ğŸ”„ æ‰§è¡Œæµç¨‹

### 1. è¾“å…¥å¤„ç†
```python
def process_input(input_data):
    # 1. æ£€æŸ¥è¾“å…¥ç±»å‹
    if isinstance(input_data, ParsedFile):
        # è½¬æ¢ ParsedFile ä¸ºå¤šæ¨¡æ€è¾“å…¥
        if input_data.file_path:
            # ä¸Šä¼ æ–‡ä»¶æˆ–ä½¿ç”¨ URL
            file_id = upload_file(input_data.file_path)
            return {
                "input": [
                    {
                        "role": "user",
                        "content": [
                            {"type": "input_file", "file_id": file_id},
                            {"type": "input_text", "text": input_data.data}
                        ]
                    }
                ]
            }
    # 2. å¤„ç†å¤šæ¨¡æ€è¾“å…¥
    # 3. å¤„ç†å›¾ç‰‡ URL
    # 4. å¤„ç†æ–‡ä»¶ URL
```

### 2. æ„å»ºè¯·æ±‚
```python
request_body = {
    "model": "gpt-5",
    "input": processed_input,
    "instructions": system_prompt,
    "reasoning": {"effort": "low"} if reasoning_enabled else None,
    "tools": mcp_services if mcp_enabled else None
}
```

### 3. è°ƒç”¨ API
```python
response = requests.post(
    "https://api.openai.com/v1/responses",
    headers={
        "Authorization": f"Bearer {api_key}",
        "Content-Type": "application/json"
    },
    json=request_body
)
```

### 4. å¤„ç†è¾“å‡º
```python
result = {
    "output_text": response.json()["output_text"],
    "usage": response.json().get("usage"),
    "file_ids": uploaded_file_ids,  # è®°å½•ä¸Šä¼ çš„æ–‡ä»¶ ID
    "input_data": input_data  # ä¿ç•™åŸå§‹è¾“å…¥
}
```

## ğŸ†š ä¸ç°æœ‰æ¶æ„çš„å¯¹æ¯”

### å½“å‰æ¶æ„ï¼ˆAI Agent + Chat Modelï¼‰
```
[è§£ææ–‡ä»¶] â†’ [AI Agent] â†’ [ChatGPT] â†’ [è¾“å‡º]
              â†“
          [Memory]
          [Tool]
```

**é—®é¢˜**ï¼š
- éœ€è¦ä¸¤ä¸ªèŠ‚ç‚¹ï¼ˆAI Agent + ChatGPTï¼‰
- ä¸åŒæ¨¡å‹ç‰¹æ€§ä¸åŒï¼Œå¯¼è‡´è°ƒç”¨å¤±è´¥
- æ— æ³•å……åˆ†åˆ©ç”¨ ChatGPT çš„ç‹¬ç‰¹ç‰¹æ€§

### æ–°æ¶æ„ï¼ˆChatGPT Agentï¼‰
```
[è§£ææ–‡ä»¶] â†’ [ChatGPT Agent] â†’ [è¾“å‡º]
              â†“
          [Memory]
          [Tool/MCP]
```

**ä¼˜åŠ¿**ï¼š
- å•ä¸ªèŠ‚ç‚¹ï¼Œé…ç½®æ›´ç®€å•
- ä¸“é—¨é’ˆå¯¹ ChatGPTï¼Œå……åˆ†åˆ©ç”¨ç‰¹æ€§
- æ”¯æŒå¤šæ¨¡æ€è¾“å…¥ã€æ–‡ä»¶ä¸Šä¼ ã€MCP æœåŠ¡
- é¿å…æ¨¡å‹ç‰¹æ€§å·®å¼‚å¯¼è‡´çš„è°ƒç”¨å¤±è´¥

## ğŸ“‹ å®ç°è®¡åˆ’

### Phase 1: åŸºç¡€åŠŸèƒ½
1. åˆ›å»º `chatgpt_agent` èŠ‚ç‚¹ç±»å‹
2. å®ç°åŸºæœ¬çš„æ–‡å­—è¾“å…¥
3. å®ç° API é…ç½®ç•Œé¢
4. å®ç°æ‰§è¡Œé€»è¾‘

### Phase 2: å¤šæ¨¡æ€è¾“å…¥
1. æ”¯æŒå›¾ç‰‡ URL è¾“å…¥
2. æ”¯æŒæ–‡ä»¶ URL è¾“å…¥
3. è‡ªåŠ¨ä»ä¸Šæ¸¸èŠ‚ç‚¹è½¬æ¢è¾“å…¥æ ¼å¼

### Phase 3: æ–‡ä»¶ä¸Šä¼ 
1. å®ç°æ–‡ä»¶ä¸Šä¼ åˆ° OpenAI Files API
2. ä½¿ç”¨ file_id åœ¨è¯·æ±‚ä¸­å¼•ç”¨æ–‡ä»¶
3. æ–‡ä»¶ç®¡ç†ï¼ˆä¸Šä¼ ã€åˆ é™¤ï¼‰

### Phase 4: MCP æœåŠ¡
1. MCP æœåŠ¡é…ç½®ç•Œé¢
2. åœ¨è¯·æ±‚ä¸­æ·»åŠ  tools å‚æ•°
3. MCP æœåŠ¡è°ƒç”¨

### Phase 5: Agent åä½œï¼ˆæœªæ¥ï¼‰
1. å¤š Agent å®šä¹‰
2. Agent ä¹‹é—´çš„ handoff
3. Agent Runner å®ç°

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [OpenAI Responses API æ–‡æ¡£](https://platform.openai.com/docs/guides/text)
- [AI Agent æ‰§è¡Œæµç¨‹](./AI_AGENT_EXECUTION_FLOW.md)
- [æ¶æ„è®¾è®¡](./ARCHITECTURE_NODE_OPERATIONS.md)

